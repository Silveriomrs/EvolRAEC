//Modifying functions.

export function pintaTablaVariables() {
  let muestroTemporales = document.getElementById("mostrarTemp").checked;
  let muestroVisibles = document.getElementById("mostrarVisibles").checked;
  const locMap = new Map();
  locMap.clear()
  limpiaTabla("tablaVariables");
  //TODO: implementing createtable function.
  const columns = ['Variable', 'Valor', 'Dir.', 'Visible'];
  const tablaVariables = document.createElement('table');
  let cabeceraTabla = document.createElement('thead');
  let filaCabecera = document.createElement('tr');
  let columnaCabecera;

  tablaVariables.appendChild(cabeceraTabla);
  cabeceraTabla.appendChild(filaCabecera);
  //
  columnaCabecera = document.createElement('th');
  columnaCabecera.innerHTML = 'Variable';
  filaCabecera.appendChild(columnaCabecera);
  //
  columnaCabecera = document.createElement('th');
  columnaCabecera.innerHTML = 'Valor';
  filaCabecera.appendChild(columnaCabecera);
  //
  columnaCabecera = document.createElement('th');
  columnaCabecera.innerHTML = 'Dir.';
  filaCabecera.appendChild(columnaCabecera);
  //
  columnaCabecera = document.createElement('th');
  columnaCabecera.innerHTML = 'Visible';
  filaCabecera.appendChild(columnaCabecera);


  let cuerpoTabla = document.createElement('tbody');
  state.arrMem.forEach((item)=>{

      let muestroTemp = false;
      let muestroVis = false;
      if (muestroTemporales || (!muestroTemporales && ( item[1].slice(0,2) != 'T_' ))){
            muestroTemp = true;
      }

      if (!muestroVisibles || (muestroVisibles && !locMap.has(item[1]) ) ){
          muestroVis = true;
      }

      if (muestroTemp && muestroVis){

        let fila = document.createElement('tr');

        let celda = document.createElement('td');
        celda.appendChild(document.createTextNode(item[1]));
        fila.appendChild(celda);

        let celda1 = document.createElement('td');
        celda1.appendChild(document.createTextNode(state.mapPila.get(posMem(item[0]))));
        fila.appendChild(celda1);

        let celda2 = document.createElement('td');
        celda2.appendChild(document.createTextNode(posMem(item[0])));
        fila.appendChild(celda2);

        let celda3 = document.createElement('td');

        if ( !locMap.has(item[1]) ) {
          locMap.set(item[1],posMem(item[0]));
          celda3.appendChild(document.createTextNode('Si'));
        } else
        celda3.appendChild(document.createTextNode('No'));

        fila.appendChild(celda3);

        cuerpoTabla.appendChild(fila);
      }
    })
    
  tablaVariables.setAttribute("border", 2);
  tablaVariables.setAttribute("id", "tablaVariables");
  tablaVariables.appendChild(cuerpoTabla);
  document.getElementById("divvariable").appendChild(tablaVariables);

  $('#tablaVariables tr').on('click', function(){
    let dato = $(this).find('td:eq(2)').html();//posicion de la tabla donde se encuentra la direcci√≥n
    clickTablaVariables(dato);
  });
}